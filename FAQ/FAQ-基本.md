###### TOP

# FAQ 基本編

## 目次

- [設定ダイアログ](#設定ダイアログ)
    - [設定ダイアログの開き方](#設定ダイアログの開き方)
- [仮想鍵盤](#仮想鍵盤)
    - [仮想鍵盤がじゃまです](#仮想鍵盤がじゃまです)
    - 仮想鍵盤が変な表示になりました
- 打鍵ガイド
    - 最後に出力した文字の打鍵列を知りたい
    - 画面に表示されている文字の打鍵列を知りたい
    - 「読み」で漢字を検索してその打鍵列を知りたい
- [配列選択](#配列選択)
    - どんな配列が使えますか
    - [配列の選択方法](#配列の選択方法)
    - [選択した配列(テーブルファイル)の内容を確認したい](#選択した配列テーブルファイルの内容を確認したい)
- [IME連携](#IME連携)
    - [IME のON/OFFに合わせてかな配列入力モードもON/OFFしたい](#IME-のONOFFに合わせてかな配列入力モードもONOFFしたい)
    - [IME にひらがなが送られません](#IME-にひらがなが送られません)
- [同時打鍵](#同時打鍵)
    - [同時打鍵で意図しない文字が入力されてしまうのを防ぎたい](#同時打鍵で意図しない文字が入力されてしまうのを防ぎたい)
    - [タイマーを使って一定時間後に同時打鍵判定をする](#タイマーを使って一定時間後に同時打鍵判定をする)
    - [自分がどのようなタイミングで打鍵しているかを知りたい](#自分がどのようなタイミングで打鍵しているかを知りたい)
- [カタカナの出し方](#カタカナの出し方)
    - [一時的にカタカナモードに変更する](#一時的にカタカナモードに変更する)
    - [ひらがなを出力した後、一括でカタカナに変換する](#ひらがなを出力した後一括でカタカナに変換する)
- [かな入力練習モード](#かな入力練習モード)

## 設定ダイアログ
### 設定ダイアログの開き方
タスクトレイに格納されている本体アイコン<br/>
![Tasktray](image/tasktray.png)<br/>
または仮想鍵盤<br/>
 ![Vkb2](image/vkb2.png)<br/>
のいずれかで右クリックすると、以下のようなメニューが表示されます。
ここで「設定画面」を選択してください。

![Menu Tasktray](image/menu-tasktray.png)


## 仮想鍵盤
漢直WSを起動し、漢直モードに入ると、初期状態ではテキストカーソルの近くに下図のような
「仮想鍵盤」が表示されます。
NICOLA配列のように同時打鍵を取り入れている場合は、シフトキーを長押しすると、
そのシフトに応じた出力文字の表示に切り替わります。
また、「□」になっているところは、複数打鍵が必要な文字に対する入口のキーを示します。

![Vkb Desc](image/vkb-desc.png)

仮想鍵盤には、次に打鍵するキーに対してどのような文字が出力されるかが表示されます。

以下に実際のキーボードのレイアウトとそれに対応する仮想鍵盤のキーの位置を図示しておきます。
数字は「[漢直キーコード](../KEYBOARD.md#TOP)」と呼称しているものです。

![Keyboard Layout](image/keyboard-layout.png)

![Vkb Key Code](image/vkb-key-code.png)

### 仮想鍵盤がじゃまです
いろいろな対処法があります。

**1. 最初から表示しない**

[設定ダイアログ](#設定ダイアログ)を開き、
「基本設定」>「仮想鍵盤表示」>「無表示」にチェックを入れ、「適用」をクリックします。

![No Vkb](image/no-vkb.png)

**2. テキストカーソルから離れた位置に表示する**

[設定ダイアログ](#設定ダイアログ)を開き、
「詳細設定」>「仮想鍵盤・モード標識」>「カレットからの相対表示位置」の
X座標、Y座標を適当な値に変更して「適用」をクリックします。

![Vkb Position](image/vkb-position.png)

**3. 仮想鍵盤をドラッグして移動する**

仮想鍵盤をマウスでドラッグして一時的に別の位置に固定することができます。
下記ツイートを参考にしてください。

https://twitter.com/kanchokker/status/1459442675849912322

**4. 最初から固定位置に表示する**

[設定ダイアログ](#設定ダイアログ)を開き、
「詳細設定」>「仮想鍵盤・モード標識」>「固定表示位置」の
X座標、Y座標を適当な値に変更して「適用」をクリックします。

なお、前項で説明したように、仮想鍵盤をドラッグして好みの位置に移動してから
「現在位置取得」ボタンをクリックすると、現在の仮想鍵盤の位置が設定できます。

![Vkb Fixed Pos](image/vkb-fixed-pos.png)

### 仮想鍵盤が変な表示になりました
(To be described)

## 配列選択
### どんな配列が使えますか
(後で書く)

### 配列の選択方法
[設定ダイアログ](#設定ダイアログ)を開き、
「基本設定」>「ファイル」>「主テーブルファイル」のドロップダウンを開きます。
`tables` というフォルダーに格納されているテーブルファイルの一覧が表示されるので、
そこから利用したい配列(テーブルファイル)を選択してください。

![Select Table File](image/select-table-file.png)

### 選択した配列(テーブルファイル)の内容を確認したい
テーブルファイル名を格納しているコンボボックスの右にある「開く」ボタンをクリックします。

![Open Table File](image/open-table-file.png)

ツールチップにも記述されていますが、選択されているテーブルファイルのパスを引数として、
「`.txt` という拡張子を持つファイルに関連付けられたプログラム」を起動します。
とくに何も関連付けをしていない場合は、メモ帳が開くと思います。

選択したテーブルファイルによっては、そこからサブテーブルをインクルードしているかもしれません。

![Okt Tblfile](image/okt-tblfile.png)

その場合は、利用者自身でエディタ等でそのサブテーブルファイルを開いてください。
なお「サクラエディタ」では、上記の `"subtables/okt-kanji.tbl"` のところに
テキストカーソルを置いて F12 を押すと、カーソル位置のファイルを開いてくれます。

## IME連携
### IME のON/OFFに合わせてかな配列入力モードもON/OFFしたい

漢直系の配列ではなく、かな配列を利用しているような場合に有用な設定となります。

[設定ダイアログ](#設定ダイアログ)を開き、
「同時打鍵・IME」>「IME連携」>「IMEの状態に合わせてデコーダをON/OFFする」にチェックを入れ、
「適用」をクリックします。

![Ime Coop](image/ime-coop.png)

### IME にひらがなが送られません
IMEに対して文字をUnicodeのまま送っているか、または送出方法がIMEの入力モードと合っていないと思われます。
[設定ダイアログ](#設定ダイアログ)を開き、
「同時打鍵・IME」>「IMEがONの時の文字送出方法」で、使用しているIMEの入力モードに合った項目を選択し、
「適用」をクリックします。

![Ime Input Mode](image/ime-input-mode.png)

## 同時打鍵
同時打鍵とは、2つ以上のキーが同時に押下された時に、
それらのキーの組み合わせに対して定義された文字列を出力する機能です。
たとえば、W と J が単打の時はそれぞれ「き」と「あ」が出力されるが、
同時に押下された場合は「ぎ」を出力する、というようなことが可能になります。

なお、W を押している時間帯と J を押している時間帯が一瞬でも重なっていれば「同時」です。

![Wj Combo](image/wj-combo.png)

ただし、時間的には同時でも、それを「同時打鍵」として扱うかどうかは、また別の判定条件があります。

必ず同時打鍵として扱うケースとして以下の場合があります。
下図のように第1打鍵の解放が第2打鍵の解放よりも後の場合は無条件で同時打鍵として扱われます。

![Wj Combo Included](image/wj-combo-included.png)

### 同時打鍵で意図しない文字が入力されてしまうのを防ぎたい

「単打のつもりでキーを連打していたら意図せず同時打鍵と判定されて別の文字が出力された」
というケースがよく生じます。これをある程度解消するために、
「同時に打鍵されている(キーの重なりがある)けど、こういう場合は同時打鍵とみなさない」
という制約を設けることができます。

#### 第1打鍵から第2打鍵までの時間に制約をかける
下図のように、第1打鍵の押下から第2打鍵の押下までの時間が 80msである場合、 デフォルトの設定では同時打鍵と判定されます。
打鍵速度の速い方だと、単打のつもりでもこれくらいの時間間隔でキー入力することがあるかと思います。

![Combo 80Ms](image/combo-80ms.png)

2つのキーの押下間隔に制約をかけて、ある一定時間以下に2つのキーが押下された場合に限り同時打鍵と判定する、
という条件を設定することができます。
[設定ダイアログ](#設定ダイアログ)の
「同時打鍵・IME」>「同時打鍵の判定条件」>「A: 第1キー押下から第2押下までの時」で設定してください。
下図は制約時間をデフォルトの 100ms から 70msに変更する例です。

![Combo 1 2 70Ms](image/combo-1-2-70ms.png)

#### 第2打鍵の押下から第1打鍵の解放までの時間に制約をかける
たとえば下図のような感じでキーを連打しているときには同時打鍵と判定せず、単打判定してほしい、
というケースです。上図の条件だけでは、このケースは同時打鍵と判定されてしまいます。

![Combo 1 2 50Ms](image/combo-1-2-50ms.png)

このようなケースを制御するために、キー押下の重なり時間がある一定時間以上の場合に限り同時打鍵と判定する、
という条件を設定することができます。
[設定ダイアログ](#設定ダイアログ)の
「同時打鍵・IME」>「同時打鍵の判定条件」>「B: 第Nキー押下から第1キー解放までの時間」で設定してください。
下図は制約時間をデフォルトの 70ms から 90msに変更する例です。

![Combo 1 2 90Ms](image/combo-1-2-90ms.png)

なお「NICALA配列」のように「同時打鍵で2キーまで」と決まっている場合は、
第2キーの押下時に同時打鍵判定が行われ、条件Bについては適用されません。

また「1文字目にはこの条件を適用しない」は初期設定ではチェックが外れていますが、
あえて「条件A だけで1文字目の同時打鍵判定をやりたい」という場合は、ここにチェックを入れてください。

#### 連続シフト可のときに2文字めを同時打鍵と判定したくない
たとえば「薙刀式」の J は、単打だと「あ」になりますが、同時打鍵の場合は相手キーを濁音化するシフトキーになります。
この機能は「連続シフト」が可能になっており、たとえば J を押しながら W, R と押すと「ぎじ」と出力されます。
この時、本当は「ぎし」と出したかったのだけど意図せず「ぎじ」になってしまった、ということもあろうかと思います。

このようなケースも上記の「条件B」で制御できます。
上図のように条件を変更すると、下図のようなケースでは2文字目の R を打鍵してから最初のシフトキー J
を解放するまでの時間 80ms が条件Bの制約時間(90ms)を下回っているので、同時打鍵ではなく単打と判定され「し」が出力されます。

![Combo 1 3 80Ms](image/combo-1-3-80ms.png)

### タイマーを使って一定時間後に同時打鍵判定をする
親指シフトでは、キーを押してから一定時間(100msとか200msとか)が経過すると、
**そのキーが押下中であっても**それを単打と判定して文字の出力を行います。

これと同様の挙動を行いたい場合は、下図のように「第1打鍵が文字キーの場合にタイマーを併用する」に
チェックを入れてください。

![Timer1](image/timer1.png)

### 自分がどのようなタイミングで打鍵しているかを知りたい
同時打鍵判定条件 A と B の制約時間を設定するには、
利用者自身がどのようなタイミングでキーを打鍵しているかを知る必要があります。
このような用途のために「打鍵ログ」を表示する機能を用意してあります。

![Stroke Log](image/stroke-log.png)

上図のように「打鍵ログ ダイアログ」>「表示」ボタンをクリックしてください。
下図のようなダイアログが表示され、キーの押下・解放および文字出力の様子がタイムスタンプとともに表示されます。

![Stroke Log Dlg](image/stroke-log-dlg.png)

第2列目(diff ms)は直前のイベントからの経過時間(ミリ秒)を表示しています。
たとえば1文字目の「ぎ」の出力を見ると、「J」押下(Down)から「W」押下まで 50ms が経過し、
その後「J」が解放(Up)されるまでに 108ms が経過していることが分かります。
なお、英大文字はキーの押下(Down)を、小文字はキーの解放(Up)を表しています。

このログを参照して利用者自身のキー打鍵のタイミングの傾向を確認し、
同時打鍵判定条件 A と B の制約時間を適切に設定してください。

## カタカナの出し方
TUT-Code など、カタカナの定義されていない配列を使用している場合に、ひらがなをカタカナに変換して出力することができます。
次の2通りの方法があります。

### 一時的にカタカナモードに変更する
ひらがなを出力するストローク列を打鍵したときにカタカナに変換して出力するモードがあります。
たとえば「ストローク」と出力したい場合は一時的にこのモードに変更してから「すとろーく」と打鍵します。

モードを切り替えるにはまずカタカナモードと通常モードの切り替え機能を呼び出す機能キーの設定が必要です。
下図のように設定ダイアログの「機能キー割当」タブで「前置呼び出し機能」の「カタカナ変換(モード)」
に適当なキーを設定してください。(下図では「英数」キーを設定)

![Katakana Key](image/katakana-key.png)

「適用」をクリックすると、以降、「英数」キーを押すたびにカタカナモードと通常モードが切り替わります。

### ひらがなを出力した後、一括でカタカナに変換する
いったんひらがなを出力した後、それを一括でカタカナに変換します。
ただし出力文字列の末尾のひらがなを全てカタカナに変換してしまうので注意が必要です。

こちらも変換のためのキーの設定が必要になります。上図で「後置呼び出し機能」の「カタカナ変換(一括)」
に適当なキーを設定してください。

カタカナ変換の対象となる部分の前にもひらがながある場合は、そこにあらかじめ「ブロッカー」を
設定しておいてください。

## かな入力練習モード
JISかなのタイピングを練習できるサイトやツールを利用している場合は、
一時的に「かな入力練習モード」に変更すると便利です。

このモードに変更するには、右クリックメニューから「その他」>「かな入力練習モード切り替え」
をクリックするか、

![Kana Training Mode](image/kana-training-mode.png)

または、「[キーアサイン編](FAG-キーアサイン.md)」で説明している方法で、
適当なキーにモード変更機能を割り当てるとよいでしょう。
下図では `Pause` キーに割り当てています。

![Kana Training Mode 2](image/kana-training-mode-2.png)

「かな入力練習モード」に入ると、下図のように仮想鍵盤の中央部が溥いピンク色に変わります。
(この色は、設定ダイアログの「フォントと色」で変更できます。)

![Kana Training Mode Vkb](image/kana-training-mode-vkb.png)

「かな入力練習モード」では、打鍵されたかな文字に対して、
IMEがOFFの状態でもそれを表す「JISかなキー」を出力するようになります。
たとえば、「あ」→`3`、「を」→`Shift+0`、「び」→`v@` のような出力となります。

